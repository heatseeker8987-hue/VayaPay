<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Merged Tools — Excel Cleaner + Decimal Converter</title>

<style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    label { display:block; margin-top: 8px; font-weight:600; }
    input[type="number"], textarea, select { width:100%; padding:8px; margin-top:6px; box-sizing:border-box; }
    textarea { height:200px; resize:vertical; }
    .controls { margin-top:10px; display:flex; gap:10px; align-items:center; }
    button { padding:8px 14px; cursor:pointer; }
    .output { background:#f7f7f7; padding:12px; white-space:pre; margin-top:14px; border:1px solid #e0e0e0; }
    .note { color:#555; font-size:0.95rem; margin-top:6px; }
    .tool-section { display:none; margin-top:20px; }
    .visible { display:block; }
    .row { display:flex; align-items:center; gap:15px; }
    .small-input { width:80px; }
</style>
</head>
<body>

<h2>Select Tool</h2>

<select id="toolSelector">
    <option value="excel">Excel Cleaner — Live Preview</option>
    <option value="decimal">Number Auto-Decimal Converter</option>
</select>

<!-- Excel Cleaner -->
<div id="excelTool" class="tool-section visible">

  <h2>Excel Cleaner — Live Preview</h2>

  <label for="colCount">Number of columns:</label>
  <input id="colCount" type="number" value="7" min="1" />

  <label for="excelInput">Paste your values:</label>
  <textarea id="excelInput" placeholder="Paste messy values here..."></textarea>

  <div class="controls">
    <button id="copyBtn">Copy Output</button>
    <div class="note">Live preview updates automatically.</div>
  </div>

  <h3>Live Cleaned Output:</h3>
  <div id="output" class="output"></div>

</div>

<!-- Decimal Converter Tool -->
<div id="decimalTool" class="tool-section">

<div class="row">
    <h2>Number Auto-Decimal Converter</h2>
    <input id="decimalCount" type="number" class="small-input" value="2" min="1">
</div>

<textarea id="input" rows="6" placeholder="Enter numbers like 104 125 368"></textarea>

<div class="box">
    <h3>Converted Output:</h3>
    <textarea id="output2" rows="6" readonly></textarea>
</div>

</div>

<script>
/* Tool Selector */
document.getElementById("toolSelector").addEventListener("change", function () {
    document.getElementById("excelTool").classList.remove("visible");
    document.getElementById("decimalTool").classList.remove("visible");

    if (this.value === "excel") {
        document.getElementById("excelTool").classList.add("visible");
    } else {
        document.getElementById("decimalTool").classList.add("visible");
    }
});

/* Excel Cleaner Logic */
const inputEl = document.getElementById('excelInput');
const colEl = document.getElementById('colCount');
const outEl = document.getElementById('output');
const copyBtn = document.getElementById('copyBtn');

let debounceTimer = null;

function scheduleClean() {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(cleanAndRender, 80);
}

inputEl.addEventListener('input', scheduleClean);
inputEl.addEventListener('paste', () => setTimeout(scheduleClean, 20));
colEl.addEventListener('input', scheduleClean);

function cleanAndRender() {
    const raw = inputEl.value || '';
    const colCount = parseInt(colEl.value, 10);

    if (!colCount || colCount <= 0) {
      outEl.innerText = 'Enter a valid number of columns.';
      return;
    }

    const rows = raw.split(/\r?\n/).filter(r => r.trim() !== '');

    const cleaned = rows.map(row => {
      let parts = row.split(/\t+|\s{2,}|\s+/);

      let tokens = parts.map(tok => {
        if (!tok) return '';
        tok = tok.replace(/,/g, '');
        tok = tok.replace(/^\.(\d)/, '0.$1');
        tok = tok.replace(/[^0-9.\-]/g, '');
        return tok;
      }).filter(t => t !== '');

      let formatted = tokens.map(t => {
        const num = parseFloat(t);
        if (isNaN(num)) return '';

        const rounded = Math.round((num + Number.EPSILON) * 100) / 100;

        if (Math.abs(rounded - Math.round(rounded)) < 1e-9)
          return String(Math.round(rounded));

        return Number(rounded.toFixed(2)).toString();
      }).filter(v => v !== '');

      if (formatted.length > colCount) {
        formatted = formatted.slice(0, colCount);
      } else {
        while (formatted.length < colCount) formatted.push('');
      }

      return formatted.join('\t');
    });

    outEl.innerText = cleaned.join('\n');
}

cleanAndRender();

copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(outEl.innerText);
      copyBtn.innerText = 'Copied!';
      setTimeout(() => copyBtn.innerText = 'Copy Output', 900);
    } catch {
      alert('Copy failed — press Ctrl+C');
    }
});

/* Decimal Auto Converter */
function convertNumber(num, decimalPlaces) {
    num = num.trim();
    if (!num) return "";

    num = num.replace(/[^0-9]/g, "");

    if (num.length <= decimalPlaces) return num;

    let beforeDecimal = num.slice(0, num.length - decimalPlaces);
    let afterDecimal = num.slice(-decimalPlaces);

    return beforeDecimal + "." + afterDecimal;
}

function updateOutput() {
    let decimalPlaces = parseInt(document.getElementById("decimalCount").value);
    let lines = document.getElementById("input").value.split(/[\s,]+/);
    let converted = lines.map(n => convertNumber(n, decimalPlaces)).join("\n");
    document.getElementById("output2").value = converted;
}

document.getElementById("input").addEventListener("input", updateOutput);
document.getElementById("decimalCount").addEventListener("input", updateOutput);
</script>

</body>
</html>
